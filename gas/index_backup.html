<!-- filename: index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>ã‚¯ã‚¤ã‚ºâ˜†ã‚«ãƒ©ã‚³ãƒ³ã‚¢ã‚«ãƒ‡ãƒŸã‚¢</title>

  <!-- ãƒ•ã‚©ãƒ³ãƒˆï¼šNoto Sans JPï¼ˆãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆæ–¹é‡ï¼šæ–‡å­—åŒ–ã‘å›é¿ï¼‰ -->
  <!-- ã‚ªãƒ•ãƒ©ã‚¤ãƒ³é‹ç”¨æ™‚ã¯ãƒ­ãƒ¼ã‚«ãƒ«ã«åŒæ¢±ã—ãŸNoto Sans JPã¸@font-faceã§æŒ‡ã—æ›¿ãˆã¦OK -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827;        /* gray-900 */
      --text:#e5e7eb;         /* gray-200 */
      --muted:#9ca3af;        /* gray-400 */
      --accent:#6366f1;       /* indigo-500 */
      --accent-2:#22d3ee;     /* cyan-400 */
      --ok:#10b981;           /* emerald-500 */
      --ng:#ef4444;           /* red-500 */
      --btn:#1f2937;          /* gray-800 */
      --btn-hover:#374151;    /* gray-700 */
      --border:#374151;       /* gray-700 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "ãƒ’ãƒ©ã‚®ãƒè§’ã‚´ ProN", "Yu Gothic UI", "Yu Gothic", "ãƒ¡ã‚¤ãƒªã‚ª", sans-serif;
      background: radial-gradient(1200px 800px at 10% 10%, rgba(34,211,238,.10), transparent 50%),
                  radial-gradient(1000px 700px at 90% 30%, rgba(99,102,241,.12), transparent 50%),
                  var(--bg);
      color:var(--text);
      line-height:1.7;
    }
    .container{
      max-width:860px; margin:40px auto; padding:28px;
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .quiz-title{
      margin:0 0 10px; font-weight:700; letter-spacing:.02em;
      font-size: clamp(20px, 4vw, 28px);
      background: linear-gradient(90deg,var(--accent), var(--accent-2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .sub{
      margin-top:0; color:var(--muted); font-size:.95rem;
    }
    .panel{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
    }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      background:var(--btn); color:#fff; border:1px solid var(--border);
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600;
      transition:.2s transform, .2s background;
    }
    .btn:hover{ background:var(--btn-hover); transform:translateY(-1px); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .full{ width:100%; justify-content:center; }
    .grid{ display:grid; gap:12px; }
    .options{ margin-top:10px; display:grid; gap:10px; }
    .option{
      width:100%; text-align:left; padding:14px 16px; font-weight:600;
      border-radius:12px; border:1px solid var(--border); background:#0b1220;
      cursor:pointer; transition:.15s transform, .15s border-color, .15s background;
    }
    .option:hover{ transform:translateY(-1px); border-color:#4b5563; }
    .option:disabled{ opacity:.8; cursor:default; }
    .option.correct{ background: rgba(16,185,129,.12); border-color:var(--ok); }
    .option.wrong{ background: rgba(239,68,68,.12); border-color:var(--ng); }
    .meta{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin:12px 0 6px; }
    .progress{
      position:relative; height:8px; background:#0b1220; border:1px solid var(--border);
      border-radius:999px; overflow:hidden; flex:1;
    }
    .bar{ position:absolute; inset:0 auto 0 0; width:0%; background:linear-gradient(90deg,var(--accent), var(--accent-2)); }
    .kpi{ font-weight:700; min-width:96px; text-align:right; }
    .muted{ color:var(--muted); font-size:.95rem; }
    .result{ text-align:center; }
    .badges{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin:8px 0 0; }
    .badge{ padding:6px 10px; border-radius:10px; background:#0b1220; border:1px solid var(--border); font-size:.9rem; }
    .visually-hidden{ position:absolute !important; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden; clip:rect(0 0 0 0); border:0; }
    .footer-note{ margin-top:16px; color:var(--muted); font-size:.85rem; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="quiz-title">ã‚¯ã‚¤ã‚ºâ˜†ã‚«ãƒ©ã‚³ãƒ³ã‚¢ã‚«ãƒ‡ãƒŸã‚¢</h1>
    <p class="sub">10å•ã®ä¸‰æŠã‚¯ã‚¤ã‚ºã€‚æ­£ã—ã„ <strong>ãƒ–ãƒ©ãƒ³ãƒ‰ï¼‹ã‚«ãƒ©ãƒ¼</strong> ã®çµ„åˆã›ã‚’é¸ã‚“ã§ãã ã•ã„ã€‚</p>

    <!-- ãƒ¡ãƒ‹ãƒ¥ãƒ¼ -->
    <div id="menu" class="panel grid">
      <button id="startBtn" class="btn full">10å•ã‚¯ã‚¤ã‚ºã‚’é–‹å§‹</button>
      <p class="muted">ã‚·ãƒ§ãƒ¼ãƒˆã‚«ãƒƒãƒˆï¼š<kbd>1</kbd>ã€œ<kbd>4</kbd>ã§é¸æŠ / <kbd>N</kbd>ã§æ¬¡ã¸</p>
    </div>

    <!-- ã‚¯ã‚¤ã‚ºæœ¬ä½“ -->
    <div id="quiz" class="panel" style="display:none;">
      <div class="meta">
        <div class="muted">å•é¡Œ <span id="qNum">1</span> / <span id="qTotal">10</span></div>
        <div class="progress" aria-hidden="true"><div id="progressBar" class="bar"></div></div>
        <div class="kpi">å¾—ç‚¹ <span id="score">0</span></div>
      </div>
      <h2 id="question" style="margin:8px 0 6px;">èª­è¾¼ä¸­â€¦</h2>
      <div id="options" class="options" role="group" aria-label="é¸æŠè‚¢"></div>
      <p id="feedback" class="muted" aria-live="polite"></p>
      <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
        <button id="nextBtn" class="btn" disabled>æ¬¡ã¸</button>
      </div>
    </div>

    <!-- çµæœ -->
    <div id="result" class="panel result" style="display:none;">
      <h2>çµæœ</h2>
      <p style="font-size:1.1rem;">ã‚¹ã‚³ã‚¢ï¼š<strong><span id="finalScore">0</span> / <span id="finalTotal">10</span></strong></p>
      <div class="badges">
        <span class="badge" id="badgeComment">â€”</span>
        <span class="badge">ãƒ™ã‚¹ãƒˆï¼š<span id="bestScore">0</span></span>
        <span class="badge">ç›´è¿‘ï¼š<span id="lastScore">0</span></span>
      </div>
      <div style="margin-top:16px; display:flex; gap:10px; justify-content:center;">
        <button id="retryBtn" class="btn">ã‚‚ã†ä¸€åº¦</button>
        <button id="homeBtn" class="btn">ãƒ¡ãƒ‹ãƒ¥ãƒ¼ã¸</button>
      </div>
      <p class="footer-note">â€»ã‚¹ã‚³ã‚¢ã¯ãƒ–ãƒ©ã‚¦ã‚¶ã«ãƒ­ãƒ¼ã‚«ãƒ«ä¿å­˜ã•ã‚Œã¾ã™ã€‚</p>
    </div>
  </div>

  <script>
  // ====== è¨­å®š ======
  const TOTAL_QUESTIONS = 10;
  const CHOICES = 4;

  // ãƒ€ãƒŸãƒ¼ãƒ‡ãƒ¼ã‚¿ï¼ˆè‡ªç”±ã«æ‹¡å¼µOKï¼‰
  const BRANDS = ['ãƒ€ã‚¹ãƒ†ã‚£ãƒ†ã‚£ãƒ¼', 'ã‚¢ã‚¤ã‚¯ãƒ­ãƒ¼ã‚¼ãƒƒãƒˆ', 'ãƒãƒ‹ãƒ¼ã‚­ã‚¹', 'ãƒŸãƒ¼ã‚¯ãƒ¬ãƒ¼ãƒ«'];
  const COLORS = ['ç‹‚æ„›ãƒ–ãƒ©ã‚¦ãƒ³', 'ãƒ›ãƒ­ãƒ–ãƒ©ã‚¦ãƒ³', 'ã¡ã‚…ã‚‹ã‚“ãƒ–ãƒ©ã‚¦ãƒ³', 'ã‚ã–ã¨ãƒ–ãƒ©ã‚¦ãƒ³', 'ã‚¯ãƒ©ã‚·ãƒƒã‚¯ãƒ–ãƒ©ã‚¦ãƒ³', 'ãƒ¢ã‚«ãƒ–ãƒ©ã‚¦ãƒ³'];

  // ====== çŠ¶æ…‹ ======
  let questions = [];
  let current = 0;
  let score = 0;
  let answered = false;

  // ====== ãƒ¦ãƒ¼ãƒ†ã‚£ãƒªãƒ†ã‚£ ======
  const $ = sel => document.querySelector(sel);
  const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);

  // æ­£ç­”1ï¼‹èª¤ç­”(ãƒŸã‚¹ãƒãƒƒãƒ)3ã‚’ç”Ÿæˆ
  function makeQuestion(i){
    const brand = BRANDS[Math.floor(Math.random()*BRANDS.length)];
    const color = COLORS[Math.floor(Math.random()*COLORS.length)];
    const correct = `${brand} ${color}`;

    // èª¤ç­”ã®ä½œã‚Šæ–¹ï¼šåŒãƒ–ãƒ©ãƒ³ãƒ‰Ã—åˆ¥ã‚«ãƒ©ãƒ¼ ã¨ åˆ¥ãƒ–ãƒ©ãƒ³ãƒ‰Ã—åŒã‚«ãƒ©ãƒ¼ ã‚’æ··ãœã‚‹
    const wrongs = new Set();

    // åŒãƒ–ãƒ©ãƒ³ãƒ‰Ã—åˆ¥ã‚«ãƒ©ãƒ¼
    const shuffledColors = shuffle(COLORS.filter(c => c !== color));
    for(const c of shuffledColors){
      if(wrongs.size >= CHOICES-1) break;
      wrongs.add(`${brand} ${c}`);
    }
    // åˆ¥ãƒ–ãƒ©ãƒ³ãƒ‰Ã—åŒã‚«ãƒ©ãƒ¼
    const shuffledBrands = shuffle(BRANDS.filter(b => b !== brand));
    for(const b of shuffledBrands){
      if(wrongs.size >= CHOICES-1) break;
      wrongs.add(`${b} ${color}`);
    }
    // ã¾ã è¶³ã‚Šãªã‘ã‚Œã°å®Œå…¨ãƒŸã‚¹ãƒãƒƒãƒã§åŸ‹ã‚ã‚‹
    outer: for(const b of shuffle(BRANDS)){
      for(const c of shuffle(COLORS)){
        if(wrongs.size >= CHOICES-1) break outer;
        const t = `${b} ${c}`;
        if(t !== correct) wrongs.add(t);
      }
    }

    const options = shuffle([{ text: correct, correct: true },
                             ...Array.from(wrongs).slice(0, CHOICES-1).map(t => ({ text: t, correct:false }))]);

    return {
      id: i + 1,
      text: `Q${i+1}: æ­£ã—ã„ã€Œãƒ–ãƒ©ãƒ³ãƒ‰ï¼‹ã‚«ãƒ©ãƒ¼ã€ã®çµ„åˆã›ã¯ã©ã‚Œï¼Ÿ`,
      options
    };
  }

  function generateQuestions(){
    const qs = [];
    for(let i=0;i<TOTAL_QUESTIONS;i++){
      qs.push(makeQuestion(i));
    }
    return qs;
  }

  // ====== ç”»é¢åˆ¶å¾¡ ======
  const startBtn = $('#startBtn');
  const nextBtn = $('#nextBtn');
  const retryBtn = $('#retryBtn');
  const homeBtn  = $('#homeBtn');

  const menu = $('#menu');
  const quiz = $('#quiz');
  const result = $('#result');

  const qNum = $('#qNum');
  const qTotal = $('#qTotal');
  const scoreEl = $('#score');
  const questionEl = $('#question');
  const optionsEl = $('#options');
  const feedbackEl = $('#feedback');
  const progressBar = $('#progressBar');

  const finalScore = $('#finalScore');
  const finalTotal = $('#finalTotal');
  const bestScore = $('#bestScore');
  const lastScore = $('#lastScore');
  const badgeComment = $('#badgeComment');

  qTotal.textContent = TOTAL_QUESTIONS;
  finalTotal.textContent = TOTAL_QUESTIONS;

  function startQuiz(){
    current = 0;
    score = 0;
    questions = generateQuestions();
    menu.style.display = 'none';
    result.style.display = 'none';
    quiz.style.display = 'block';
    renderQuestion();
  }

  function renderQuestion(){
    if(current >= TOTAL_QUESTIONS){
      showResult();
      return;
    }
    answered = false;
    const q = questions[current];
    qNum.textContent = current + 1;
    questionEl.textContent = q.text;
    feedbackEl.textContent = '';
    nextBtn.disabled = true;

    // é€²æ—ãƒãƒ¼
    const pct = Math.round((current / TOTAL_QUESTIONS) * 100);
    progressBar.style.width = pct + '%';

    // é¸æŠè‚¢ã‚’æç”»
    optionsEl.innerHTML = '';
    q.options.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'option';
      btn.textContent = opt.text;
      btn.setAttribute('data-idx', idx);
      btn.addEventListener('click', () => handleSelect(btn, opt.correct));
      optionsEl.appendChild(btn);
    });

    // æœ€åˆã®é¸æŠè‚¢ã«ãƒ•ã‚©ãƒ¼ã‚«ã‚¹
    const first = optionsEl.querySelector('.option');
    if(first) first.focus();
  }

  function handleSelect(btn, isCorrect){
    if(answered) return;         // å¤šé‡ã‚¯ãƒªãƒƒã‚¯é˜²æ­¢
    answered = true;

    // å…¨ãƒœã‚¿ãƒ³ã‚’ä¸€æ—¦ç„¡åŠ¹åŒ–
    optionsEl.querySelectorAll('.option').forEach(b => b.disabled = true);

    // æ­£è§£ãƒœã‚¿ãƒ³ã‚’ãƒã‚¤ãƒ©ã‚¤ãƒˆ
    const q = questions[current];
    const correctBtn = Array.from(optionsEl.children)
      .find(b => {
        const i = parseInt(b.getAttribute('data-idx'),10);
        return q.options[i].correct;
      });
    if(correctBtn) correctBtn.classList.add('correct');

    if(isCorrect){
      btn.classList.add('correct');
      score++;
      scoreEl.textContent = score;
      feedbackEl.textContent = 'æ­£è§£ï¼ãƒŠã‚¤ã‚¹ã§ã™ã€‚';
    }else{
      btn.classList.add('wrong');
      const correctText = q.options.find(o=>o.correct).text;
      feedbackEl.textContent = `ä¸æ­£è§£â€¦ æ­£ã—ã„çµ„åˆã›ã¯ã€Œ${correctText}ã€ã§ã—ãŸã€‚`;
    }
    nextBtn.disabled = false;
    nextBtn.focus();
  }

  function nextQuestion(){
    if(!answered) return; // å¿µã®ãŸã‚
    current++;
    renderQuestion();
  }

  function showResult(){
    quiz.style.display = 'none';
    result.style.display = 'block';
    finalScore.textContent = score;

    // ãƒ­ãƒ¼ã‚«ãƒ«ã«ä¿å­˜ï¼ˆãƒ™ã‚¹ãƒˆ/ç›´è¿‘ï¼‰
    const last = { score, total: TOTAL_QUESTIONS, at: new Date().toISOString() };
    localStorage.setItem('quiz_last', JSON.stringify(last));

    const best = Math.max(score, Number(localStorage.getItem('quiz_best')||0));
    localStorage.setItem('quiz_best', String(best));

    bestScore.textContent = best;
    lastScore.textContent = score;
    badgeComment.textContent =
      score === TOTAL_QUESTIONS ? 'æº€ç‚¹ï¼å®Œç’§ã§ã™ğŸ‰' :
      score >= Math.ceil(TOTAL_QUESTIONS*0.8) ? 'ã™ã”ã„ï¼ã‹ãªã‚Šå‡ºæ¥ã¦ã¾ã™' :
      score >= Math.ceil(TOTAL_QUESTIONS*0.5) ? 'ã‚ã¨ä¸€æ­©ã€‚ã‚‚ã†ä¸€å‘¨ï¼' :
      'åŸºç¤å›ºã‚ã‹ã‚‰ã„ãã¾ã—ã‚‡ã†';
    // é€²æ—ãƒãƒ¼æº€äº†
    progressBar.style.width = '100%';
  }

  function resetToMenu(){
    menu.style.display = 'grid';
    quiz.style.display = 'none';
    result.style.display = 'none';
  }

  // ====== ã‚­ãƒ¼æ“ä½œ ======
  document.addEventListener('keydown', (e) => {
    // 1ã€œ4ã§é¸æŠ
    if(quiz.style.display !== 'none'){
      if(['1','2','3','4'].includes(e.key)){
        const idx = Number(e.key) - 1;
        const target = optionsEl.querySelector(`.option:nth-child(${idx+1})`);
        if(target && !answered) target.click();
      }
      // Nã§æ¬¡ã¸
      if((e.key === 'n' || e.key === 'N') && !nextBtn.disabled){
        nextBtn.click();
      }
    }
  });

  // ====== ãƒœã‚¿ãƒ³ç´ä»˜ã‘ ======
  startBtn.addEventListener('click', startQuiz);
  nextBtn.addEventListener('click', nextQuestion);
  retryBtn.addEventListener('click', startQuiz);
  homeBtn.addEventListener('click', resetToMenu);

  // åˆæœŸåŒ–ï¼šãƒ™ã‚¹ãƒˆè¡¨ç¤ºã®ãŸã‚
  (function init(){
    const best = Number(localStorage.getItem('quiz_best')||0);
    bestScore.textContent = best;
    const lastRaw = localStorage.getItem('quiz_last');
    if(lastRaw){
      try{ lastScore.textContent = JSON.parse(lastRaw).score; }catch{}
    }
  })();
  </script>
</body>
</html>
