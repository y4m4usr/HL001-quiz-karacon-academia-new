<!-- filename: index.html -->
<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>クイズ☆カラコンアカデミア</title>

  <!-- フォント：Noto Sans JP（プロジェクト方針：文字化け回避） -->
  <!-- オフライン運用時はローカルに同梱したNoto Sans JPへ@font-faceで指し替えてOK -->
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@400;600;700&display=swap" rel="stylesheet">

  <style>
    :root{
      --bg:#0f172a;           /* slate-900 */
      --panel:#111827;        /* gray-900 */
      --text:#e5e7eb;         /* gray-200 */
      --muted:#9ca3af;        /* gray-400 */
      --accent:#6366f1;       /* indigo-500 */
      --accent-2:#22d3ee;     /* cyan-400 */
      --ok:#10b981;           /* emerald-500 */
      --ng:#ef4444;           /* red-500 */
      --btn:#1f2937;          /* gray-800 */
      --btn-hover:#374151;    /* gray-700 */
      --border:#374151;       /* gray-700 */
      --shadow: 0 10px 30px rgba(0,0,0,.35);
      --radius:14px;
    }
    *{ box-sizing:border-box; }
    html,body{ height:100%; }
    body{
      margin:0;
      font-family:"Noto Sans JP", system-ui, -apple-system, Segoe UI, Roboto, "Hiragino Sans", "ヒラギノ角ゴ ProN", "Yu Gothic UI", "Yu Gothic", "メイリオ", sans-serif;
      background: radial-gradient(1200px 800px at 10% 10%, rgba(34,211,238,.10), transparent 50%),
                  radial-gradient(1000px 700px at 90% 30%, rgba(99,102,241,.12), transparent 50%),
                  var(--bg);
      color:var(--text);
      line-height:1.7;
    }
    .container{
      max-width:860px; margin:40px auto; padding:28px;
      background:linear-gradient(180deg, rgba(255,255,255,.02), rgba(255,255,255,0));
      border:1px solid rgba(255,255,255,.06);
      border-radius: var(--radius);
      box-shadow: var(--shadow);
    }
    .quiz-title{
      margin:0 0 10px; font-weight:700; letter-spacing:.02em;
      font-size: clamp(20px, 4vw, 28px);
      background: linear-gradient(90deg,var(--accent), var(--accent-2));
      -webkit-background-clip:text; background-clip:text; color:transparent;
    }
    .sub{
      margin-top:0; color:var(--muted); font-size:.95rem;
    }
    .panel{
      background: var(--panel);
      border:1px solid var(--border);
      border-radius: var(--radius);
      padding:18px;
    }
    .btn{
      display:inline-flex; align-items:center; gap:10px;
      background:var(--btn); color:#fff; border:1px solid var(--border);
      padding:12px 16px; border-radius:12px; cursor:pointer; font-weight:600;
      transition:.2s transform, .2s background;
    }
    .btn:hover{ background:var(--btn-hover); transform:translateY(-1px); }
    .btn:disabled{ opacity:.6; cursor:not-allowed; transform:none; }
    .full{ width:100%; justify-content:center; }
    .grid{ display:grid; gap:12px; }
    .options{ margin-top:10px; display:grid; gap:10px; }
    .option{
      width:100%; text-align:left; padding:14px 16px; font-weight:600;
      border-radius:12px; border:1px solid var(--border); background:#0b1220;
      cursor:pointer; transition:.15s transform, .15s border-color, .15s background;
    }
    .option:hover{ transform:translateY(-1px); border-color:#4b5563; }
    .option:disabled{ opacity:.8; cursor:default; }
    .option.correct{ background: rgba(16,185,129,.12); border-color:var(--ok); }
    .option.wrong{ background: rgba(239,68,68,.12); border-color:var(--ng); }
    .meta{ display:flex; justify-content:space-between; align-items:center; gap:10px; margin:12px 0 6px; }
    .progress{
      position:relative; height:8px; background:#0b1220; border:1px solid var(--border);
      border-radius:999px; overflow:hidden; flex:1;
    }
    .bar{ position:absolute; inset:0 auto 0 0; width:0%; background:linear-gradient(90deg,var(--accent), var(--accent-2)); }
    .kpi{ font-weight:700; min-width:96px; text-align:right; }
    .muted{ color:var(--muted); font-size:.95rem; }
    .result{ text-align:center; }
    .badges{ display:flex; flex-wrap:wrap; gap:8px; justify-content:center; margin:8px 0 0; }
    .badge{ padding:6px 10px; border-radius:10px; background:#0b1220; border:1px solid var(--border); font-size:.9rem; }
    .visually-hidden{ position:absolute !important; width:1px; height:1px; margin:-1px; padding:0; overflow:hidden; clip:rect(0 0 0 0); border:0; }
    .footer-note{ margin-top:16px; color:var(--muted); font-size:.85rem; text-align:center; }
  </style>
</head>
<body>
  <div class="container">
    <h1 class="quiz-title">クイズ☆カラコンアカデミア</h1>
    <p class="sub">10問の三択クイズ。正しい <strong>ブランド＋カラー</strong> の組合せを選んでください。</p>

    <!-- メニュー -->
    <div id="menu" class="panel grid">
      <button id="startBtn" class="btn full">10問クイズを開始</button>
      <p class="muted">ショートカット：<kbd>1</kbd>〜<kbd>4</kbd>で選択 / <kbd>N</kbd>で次へ</p>
    </div>

    <!-- クイズ本体 -->
    <div id="quiz" class="panel" style="display:none;">
      <div class="meta">
        <div class="muted">問題 <span id="qNum">1</span> / <span id="qTotal">10</span></div>
        <div class="progress" aria-hidden="true"><div id="progressBar" class="bar"></div></div>
        <div class="kpi">得点 <span id="score">0</span></div>
      </div>
      <h2 id="question" style="margin:8px 0 6px;">読込中…</h2>
      <div id="options" class="options" role="group" aria-label="選択肢"></div>
      <p id="feedback" class="muted" aria-live="polite"></p>
      <div style="margin-top:10px; display:flex; gap:10px; justify-content:flex-end;">
        <button id="nextBtn" class="btn" disabled>次へ</button>
      </div>
    </div>

    <!-- 結果 -->
    <div id="result" class="panel result" style="display:none;">
      <h2>結果</h2>
      <p style="font-size:1.1rem;">スコア：<strong><span id="finalScore">0</span> / <span id="finalTotal">10</span></strong></p>
      <div class="badges">
        <span class="badge" id="badgeComment">—</span>
        <span class="badge">ベスト：<span id="bestScore">0</span></span>
        <span class="badge">直近：<span id="lastScore">0</span></span>
      </div>
      <div style="margin-top:16px; display:flex; gap:10px; justify-content:center;">
        <button id="retryBtn" class="btn">もう一度</button>
        <button id="homeBtn" class="btn">メニューへ</button>
      </div>
      <p class="footer-note">※スコアはブラウザにローカル保存されます。</p>
    </div>
  </div>

  <script>
  // ====== 設定 ======
  const TOTAL_QUESTIONS = 10;
  const CHOICES = 4;

  // ダミーデータ（自由に拡張OK）
  const BRANDS = ['ダスティティー', 'アイクローゼット', 'ハニーキス', 'ミークレール'];
  const COLORS = ['狂愛ブラウン', 'ホロブラウン', 'ちゅるんブラウン', 'あざとブラウン', 'クラシックブラウン', 'モカブラウン'];

  // ====== 状態 ======
  let questions = [];
  let current = 0;
  let score = 0;
  let answered = false;

  // ====== ユーティリティ ======
  const $ = sel => document.querySelector(sel);
  const shuffle = (arr) => arr.map(v=>[Math.random(),v]).sort((a,b)=>a[0]-b[0]).map(v=>v[1]);

  // 正答1＋誤答(ミスマッチ)3を生成
  function makeQuestion(i){
    const brand = BRANDS[Math.floor(Math.random()*BRANDS.length)];
    const color = COLORS[Math.floor(Math.random()*COLORS.length)];
    const correct = `${brand} ${color}`;

    // 誤答の作り方：同ブランド×別カラー と 別ブランド×同カラー を混ぜる
    const wrongs = new Set();

    // 同ブランド×別カラー
    const shuffledColors = shuffle(COLORS.filter(c => c !== color));
    for(const c of shuffledColors){
      if(wrongs.size >= CHOICES-1) break;
      wrongs.add(`${brand} ${c}`);
    }
    // 別ブランド×同カラー
    const shuffledBrands = shuffle(BRANDS.filter(b => b !== brand));
    for(const b of shuffledBrands){
      if(wrongs.size >= CHOICES-1) break;
      wrongs.add(`${b} ${color}`);
    }
    // まだ足りなければ完全ミスマッチで埋める
    outer: for(const b of shuffle(BRANDS)){
      for(const c of shuffle(COLORS)){
        if(wrongs.size >= CHOICES-1) break outer;
        const t = `${b} ${c}`;
        if(t !== correct) wrongs.add(t);
      }
    }

    const options = shuffle([{ text: correct, correct: true },
                             ...Array.from(wrongs).slice(0, CHOICES-1).map(t => ({ text: t, correct:false }))]);

    return {
      id: i + 1,
      text: `Q${i+1}: 正しい「ブランド＋カラー」の組合せはどれ？`,
      options
    };
  }

  function generateQuestions(){
    const qs = [];
    for(let i=0;i<TOTAL_QUESTIONS;i++){
      qs.push(makeQuestion(i));
    }
    return qs;
  }

  // ====== 画面制御 ======
  const startBtn = $('#startBtn');
  const nextBtn = $('#nextBtn');
  const retryBtn = $('#retryBtn');
  const homeBtn  = $('#homeBtn');

  const menu = $('#menu');
  const quiz = $('#quiz');
  const result = $('#result');

  const qNum = $('#qNum');
  const qTotal = $('#qTotal');
  const scoreEl = $('#score');
  const questionEl = $('#question');
  const optionsEl = $('#options');
  const feedbackEl = $('#feedback');
  const progressBar = $('#progressBar');

  const finalScore = $('#finalScore');
  const finalTotal = $('#finalTotal');
  const bestScore = $('#bestScore');
  const lastScore = $('#lastScore');
  const badgeComment = $('#badgeComment');

  qTotal.textContent = TOTAL_QUESTIONS;
  finalTotal.textContent = TOTAL_QUESTIONS;

  function startQuiz(){
    current = 0;
    score = 0;
    questions = generateQuestions();
    menu.style.display = 'none';
    result.style.display = 'none';
    quiz.style.display = 'block';
    renderQuestion();
  }

  function renderQuestion(){
    if(current >= TOTAL_QUESTIONS){
      showResult();
      return;
    }
    answered = false;
    const q = questions[current];
    qNum.textContent = current + 1;
    questionEl.textContent = q.text;
    feedbackEl.textContent = '';
    nextBtn.disabled = true;

    // 進捗バー
    const pct = Math.round((current / TOTAL_QUESTIONS) * 100);
    progressBar.style.width = pct + '%';

    // 選択肢を描画
    optionsEl.innerHTML = '';
    q.options.forEach((opt, idx) => {
      const btn = document.createElement('button');
      btn.type = 'button';
      btn.className = 'option';
      btn.textContent = opt.text;
      btn.setAttribute('data-idx', idx);
      btn.addEventListener('click', () => handleSelect(btn, opt.correct));
      optionsEl.appendChild(btn);
    });

    // 最初の選択肢にフォーカス
    const first = optionsEl.querySelector('.option');
    if(first) first.focus();
  }

  function handleSelect(btn, isCorrect){
    if(answered) return;         // 多重クリック防止
    answered = true;

    // 全ボタンを一旦無効化
    optionsEl.querySelectorAll('.option').forEach(b => b.disabled = true);

    // 正解ボタンをハイライト
    const q = questions[current];
    const correctBtn = Array.from(optionsEl.children)
      .find(b => {
        const i = parseInt(b.getAttribute('data-idx'),10);
        return q.options[i].correct;
      });
    if(correctBtn) correctBtn.classList.add('correct');

    if(isCorrect){
      btn.classList.add('correct');
      score++;
      scoreEl.textContent = score;
      feedbackEl.textContent = '正解！ナイスです。';
    }else{
      btn.classList.add('wrong');
      const correctText = q.options.find(o=>o.correct).text;
      feedbackEl.textContent = `不正解… 正しい組合せは「${correctText}」でした。`;
    }
    nextBtn.disabled = false;
    nextBtn.focus();
  }

  function nextQuestion(){
    if(!answered) return; // 念のため
    current++;
    renderQuestion();
  }

  function showResult(){
    quiz.style.display = 'none';
    result.style.display = 'block';
    finalScore.textContent = score;

    // ローカルに保存（ベスト/直近）
    const last = { score, total: TOTAL_QUESTIONS, at: new Date().toISOString() };
    localStorage.setItem('quiz_last', JSON.stringify(last));

    const best = Math.max(score, Number(localStorage.getItem('quiz_best')||0));
    localStorage.setItem('quiz_best', String(best));

    bestScore.textContent = best;
    lastScore.textContent = score;
    badgeComment.textContent =
      score === TOTAL_QUESTIONS ? '満点！完璧です🎉' :
      score >= Math.ceil(TOTAL_QUESTIONS*0.8) ? 'すごい！かなり出来てます' :
      score >= Math.ceil(TOTAL_QUESTIONS*0.5) ? 'あと一歩。もう一周！' :
      '基礎固めからいきましょう';
    // 進捗バー満了
    progressBar.style.width = '100%';
  }

  function resetToMenu(){
    menu.style.display = 'grid';
    quiz.style.display = 'none';
    result.style.display = 'none';
  }

  // ====== キー操作 ======
  document.addEventListener('keydown', (e) => {
    // 1〜4で選択
    if(quiz.style.display !== 'none'){
      if(['1','2','3','4'].includes(e.key)){
        const idx = Number(e.key) - 1;
        const target = optionsEl.querySelector(`.option:nth-child(${idx+1})`);
        if(target && !answered) target.click();
      }
      // Nで次へ
      if((e.key === 'n' || e.key === 'N') && !nextBtn.disabled){
        nextBtn.click();
      }
    }
  });

  // ====== ボタン紐付け ======
  startBtn.addEventListener('click', startQuiz);
  nextBtn.addEventListener('click', nextQuestion);
  retryBtn.addEventListener('click', startQuiz);
  homeBtn.addEventListener('click', resetToMenu);

  // 初期化：ベスト表示のため
  (function init(){
    const best = Number(localStorage.getItem('quiz_best')||0);
    bestScore.textContent = best;
    const lastRaw = localStorage.getItem('quiz_last');
    if(lastRaw){
      try{ lastScore.textContent = JSON.parse(lastRaw).score; }catch{}
    }
  })();
  </script>
</body>
</html>
