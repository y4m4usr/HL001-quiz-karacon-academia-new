<!DOCTYPE html>
<html lang="ja">
<head>
    <base target="_top">
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Quiz‚òÜ„Ç´„É©„Ç≥„É≥„Ç¢„Ç´„Éá„Éü„Ç¢</title>
    <style>
        /* CSS„Çπ„Çø„Ç§„É´„ÅØÂ§âÊõ¥„ÅÇ„Çä„Åæ„Åõ„Çì„ÅÆ„Åß„ÄÅ„Åì„Åì„Åß„ÅØÁúÅÁï•„Åó„Åæ„Åô */
        body { font-family: sans-serif; background: #fff2f7; }
        .hidden { display: none !important; }
        /* (‰ª•‰∏ã„ÄÅÂÖÉ„ÅÆ„Çπ„Çø„Ç§„É´„ÅåÁ∂ö„Åç„Åæ„Åô) */
        *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }
        .shell { max-width: 480px; margin: 0 auto; padding: 20px; }
        .hero { display: flex; align-items: center; gap: 16px; margin-bottom: 24px; padding: 16px; background: white; border-radius: 20px; box-shadow: 0 4px 20px rgba(0,0,0,0.08); }
        .logo { width: 56px; height: 56px; border-radius: 12px; background: linear-gradient(135deg, #FF6EC7, #FF9472); display: flex; align-items: center; justify-content: center; font-size: 28px; flex-shrink: 0; }
        .hero-text h1 { font-size: 18px; font-weight: 700; color: #333; margin-bottom: 4px; }
        .api { color: #999; font-size: 12px; }
        .card { background: white; border-radius: 20px; padding: 24px; box-shadow: 0 6px 20px rgba(0,0,0,0.06); margin-bottom: 20px; }
        .card h2 { margin-bottom: 20px; color: #333; }
        .input-group { margin-bottom: 20px; }
        label { display: block; margin-bottom: 8px; color: #666; font-size: 14px; font-weight: 500; }
        input { width: 100%; padding: 14px 16px; border: 2px solid #E0E0E0; border-radius: 12px; font-size: 16px; background: white; transition: border-color 0.2s ease; }
        input:focus { outline: none; border-color: #FF6EC7; box-shadow: 0 0 0 3px rgba(255, 110, 199, 0.1); }
        .btn { padding: 16px 24px; border: none; border-radius: 12px; font-size: 16px; font-weight: 600; cursor: pointer; width: 100%; transition: all 0.2s ease; text-align: center; display: inline-flex; align-items: center; justify-content: center; gap: 8px; }
        .btn-primary { background: linear-gradient(135deg, #FF6EC7, #FF9472); color: white; box-shadow: 0 4px 12px rgba(255, 110, 199, 0.3); }
        .btn-primary:hover { transform: translateY(-2px); box-shadow: 0 6px 20px rgba(255, 110, 199, 0.4); }
        .quiz-header { background: linear-gradient(135deg, #FF6EC7, #FF9472); color: white; padding: 20px; border-radius: 20px; margin-bottom: 20px; }
        .quiz-info { display: flex; justify-content: space-between; align-items: center; margin-bottom: 16px; }
        .timer { background: rgba(255,255,255,0.2); padding: 8px 16px; border-radius: 20px; font-weight: bold; font-size: 14px; }
        .timer.warning { background: #FF4444; animation: pulse 1s infinite; }
        @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: 0.7; } }
        .progress-bar { background: rgba(255,255,255,0.3); height: 8px; border-radius: 4px; overflow: hidden; }
        .progress-fill { background: white; height: 100%; transition: width 0.5s ease; }
        .lens-container { text-align: center; margin-bottom: 24px; }
        .lens-label { font-size: 16px; color: #666; margin-bottom: 20px; font-weight: 500; }
        .lens-display { display: flex; justify-content: center; gap: 20px; margin-bottom: 20px; }
        .lens-image { width: 120px; height: 120px; border-radius: 50%; box-shadow: 0 8px 24px rgba(0,0,0,0.15); object-fit: cover; border: 4px solid #FFD2EC; }
        .hint-buttons { display: flex; gap: 12px; margin-bottom: 20px; }
        .hint-btn { flex: 1; padding: 12px 16px; background: #FFF0F8; border: 2px solid #FFD2EC; border-radius: 12px; color: #FF6EC7; cursor: pointer; font-weight: 600; font-size: 14px; transition: all 0.2s ease; }
        .hint-btn:hover { background: #FFE3F2; }
        .hint-btn.used { background: #FFD2EC; opacity: 0.6; cursor: not-allowed; }
        .hint-display { display: none; background: #FFF9E6; border: 2px solid #FFE59E; border-radius: 12px; padding: 16px; margin-bottom: 20px; color: #8B6914; font-size: 14px; white-space: pre-line; line-height: 1.6; }
        .hint-display.show { display: block; animation: slideDown 0.3s ease; }
        @keyframes slideDown { from { opacity: 0; transform: translateY(-10px); } to { opacity: 1; transform: translateY(0); } }
        .answer-options { display: grid; gap: 12px; margin-bottom: 24px; }
        .answer-option { background: white; border: 2px solid #E0E0E0; border-radius: 12px; padding: 16px; cursor: pointer; transition: all 0.3s ease; display: flex; align-items: center; gap: 12px; }
        .answer-option:hover { border-color: #FF6EC7; background: #FFF0F8; transform: translateY(-1px); }
        .answer-option.selected { border-color: #FF6EC7; background: #FFE3F2; transform: translateY(-2px); box-shadow: 0 4px 12px rgba(255, 110, 199, 0.2); }
        .feedback-overlay { position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0,0,0,0.6); display: flex; align-items: center; justify-content: center; z-index: 1000; animation: fadeIn 0.3s ease; }
        .feedback-card { background: white; padding: 32px; border-radius: 24px; text-align: center; max-width: 320px; margin: 20px; box-shadow: 0 12px 40px rgba(0,0,0,0.3); animation: scaleIn 0.3s ease; }
        @keyframes fadeIn { from { opacity: 0; } to { opacity: 1; } }
        @keyframes scaleIn { from { opacity: 0; transform: scale(0.8); } to { opacity: 1; transform: scale(1); } }
        .feedback-correct { border: 4px solid #4CAF50; }
        .feedback-incorrect { border: 4px solid #F44336; }
    </style>
</head>
<body>
    <div class="shell">
        <!-- „Éö„Éº„Ç∏„Ç≥„É≥„ÉÜ„Éä„ÅØÂ§âÊõ¥„Å™„Åó„ÅÆ„Åü„ÇÅÁúÅÁï• -->
        <div id="loginPage" class="page">
            <div class="card">
                <h2>„É≠„Ç∞„Ç§„É≥</h2>
                <div class="input-group">
                    <label for="staffId">‰ºöÂì°Áï™Âè∑</label>
                    <input type="text" id="staffId" placeholder="‰æãÔºöST001">
                </div>
                <div class="input-group">
                    <label for="userName">‰ºöÂì°Âêç</label>
                    <input type="text" id="userName" placeholder="‰æãÔºöÂ±±Áî∞Ëä±Â≠ê">
                </div>
                <button id="loginBtn" class="btn btn-primary">„É≠„Ç∞„Ç§„É≥</button>
            </div>
        </div>

        <div id="homePage" class="page hidden">
            <!-- „Éõ„Éº„É†ÁîªÈù¢„ÅÆHTML... -->
            <button id="startPracticeBtn" class="btn btn-primary">Á∑¥Áøí„É¢„Éº„ÉâÈñãÂßã</button>
        </div>

        <div id="quizPage" class="page hidden">
            <div class="quiz-header">
                <div class="quiz-info">
                    <div>Question <span id="currentQuestionNum">1</span>/10</div>
                    <div class="timer" id="timer">‚è± <span id="timeLeft">20</span>Áßí</div>
                </div>
                <div class="progress-bar"><div id="progressFill" class="progress-fill" style="width: 10%;"></div></div>
            </div>
            <div class="card">
                <div class="lens-container">
                    <div class="lens-label">„Åì„ÅÆ„Ç´„É©„Ç≥„É≥„ÅØ‰ΩïÔºü</div>
                    <div class="lens-display">
                        <img class="lens-image" id="leftLens" alt="Â∑¶„É¨„É≥„Ç∫">
                        <img class="lens-image" id="rightLens" alt="Âè≥„É¨„É≥„Ç∫">
                    </div>
                </div>
                <div class="hint-buttons">
                    <button class="hint-btn" id="hint1Btn">üí° „Éí„É≥„Éà1</button>
                    <button class="hint-btn" id="hint2Btn">üí° „Éí„É≥„Éà2</button>
                </div>
                <div class="hint-display" id="hintDisplay"></div>
                <div class="answer-options" id="answerOptions"></div>
                <button class="btn btn-primary" id="submitBtn">ÂõûÁ≠î„Åô„Çã</button>
            </div>
        </div>

        <div id="resultPage" class="page hidden">
            <!-- ÁµêÊûúÁîªÈù¢„ÅÆHTML... -->
        </div>

        <div id="feedbackOverlay" class="feedback-overlay hidden">
            <div class="feedback-card" id="feedbackCard">
                <div id="feedbackIcon" style="font-size: 48px;"></div>
                <div id="feedbackTitle" style="font-size: 24px; font-weight: bold;"></div>
                <div id="feedbackMessage"></div>
            </div>
        </div>
    </div>

    <script>
    // ===================================================================
    // „Ç¢„Éó„É™„Ç±„Éº„Ç∑„Éß„É≥„É°„Ç§„É≥„Çπ„ÇØ„É™„Éó„Éà
    // ===================================================================
    const App = (() => {
        'use strict';

        // --- Áä∂ÊÖãÁÆ°ÁêÜ ---
        const state = {
            currentUser: null,
            quizData: null,
            currentQuestionIndex: 0,
            selectedAnswerKey: null,
            answers: [],
            timer: null,
            timeLeft: 20,
            hintsUsed: { h1: false, h2: false },
            gameMode: 'practice'
        };

        // --- DOMË¶ÅÁ¥† ---
        const DOMElements = {
            pages: {
                login: document.getElementById('loginPage'),
                home: document.getElementById('homePage'),
                quiz: document.getElementById('quizPage'),
                result: document.getElementById('resultPage')
            },
            quiz: {
                currentNum: document.getElementById('currentQuestionNum'),
                progressFill: document.getElementById('progressFill'),
                timeLeft: document.getElementById('timeLeft'),
                timer: document.getElementById('timer'),
                leftLens: document.getElementById('leftLens'),
                rightLens: document.getElementById('rightLens'),
                hint1Btn: document.getElementById('hint1Btn'),
                hint2Btn: document.getElementById('hint2Btn'),
                hintDisplay: document.getElementById('hintDisplay'),
                optionsContainer: document.getElementById('answerOptions'),
                submitBtn: document.getElementById('submitBtn')
            },
            feedback: {
                overlay: document.getElementById('feedbackOverlay'),
                card: document.getElementById('feedbackCard'),
                icon: document.getElementById('feedbackIcon'),
                title: document.getElementById('feedbackTitle'),
                message: document.getElementById('feedbackMessage')
            }
        };

        // --- Èñ¢Êï∞ ---
        function showPage(pageId) {
            Object.values(DOMElements.pages).forEach(p => p.classList.add('hidden'));
            const page = DOMElements.pages[pageId];
            if (page) page.classList.remove('hidden');
        }

        function startQuiz(mode) {
            state.gameMode = mode;
            showPage('quiz');
            
            // „É≠„Éº„Éá„Ç£„É≥„Ç∞Ë°®Á§∫
            DOMElements.quiz.optionsContainer.innerHTML = '<p>ÂïèÈ°å„ÇíÂèñÂæó‰∏≠...</p>';

            google.script.run
                .withSuccessHandler(onQuestionsLoaded)
                .withFailureHandler(onQuestionsFailed)
                .getQuestions({ count: 10 });
        }

        function onQuestionsLoaded(questions) {
            if (!questions || !questions.length) {
                onQuestionsFailed({ message: 'ÂïèÈ°å„Åå„ÅÇ„Çä„Åæ„Åõ„Çì„ÄÇ' });
                return;
            }
            state.quizData = questions;
            state.currentQuestionIndex = 0;
            state.answers = [];
            loadQuestion();
        }

        function onQuestionsFailed(error) {
            alert('ÂïèÈ°å„ÅÆÂèñÂæó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü: ' + error.message);
            showPage('home');
        }

        function loadQuestion() {
            if (state.currentQuestionIndex >= state.quizData.length) {
                finishQuiz();
                return;
            }
            const q = state.quizData[state.currentQuestionIndex];
            
            // UIÊõ¥Êñ∞
            DOMElements.quiz.currentNum.textContent = state.currentQuestionIndex + 1;
            DOMElements.quiz.progressFill.style.width = `${(state.currentQuestionIndex + 1) * 10}%`;
            
            // ÁîªÂÉèË®≠ÂÆö („Ç®„É©„Éº„Éè„É≥„Éâ„É©‰ªò„Åç)
            setImgSafe(DOMElements.quiz.leftLens, q.imgL, 'Lens');
            setImgSafe(DOMElements.quiz.rightLens, q.imgR, 'Lens');

            // ÈÅ∏ÊäûËÇ¢
            const opts = DOMElements.quiz.optionsContainer;
            opts.innerHTML = '';
            q.options.forEach(optionKey => {
                const div = document.createElement('div');
                div.className = 'answer-option';
                div.dataset.key = optionKey;
                div.textContent = optionKey;
                div.onclick = () => selectOption(div);
                opts.appendChild(div);
            });

            // „Éí„É≥„Éà„Å®„Çø„Ç§„Éû„Éº„ÅÆ„É™„Çª„ÉÉ„Éà
            resetHints();
            startTimer();
            state.selectedAnswerKey = null;
        }

        function selectOption(el) {
            document.querySelectorAll('.answer-option').forEach(opt => opt.classList.remove('selected'));
            el.classList.add('selected');
            state.selectedAnswerKey = el.dataset.key;
        }

        function startTimer() {
            state.timeLeft = 20;
            DOMElements.quiz.timeLeft.textContent = state.timeLeft;
            DOMElements.quiz.timer.classList.remove('warning');
            clearInterval(state.timer);
            state.timer = setInterval(() => {
                state.timeLeft--;
                DOMElements.quiz.timeLeft.textContent = state.timeLeft;
                if (state.timeLeft <= 5) DOMElements.quiz.timer.classList.add('warning');
                if (state.timeLeft <= 0) submitAnswer(true);
            }, 1000);
        }

        function submitAnswer(isTimeout = false) {
            clearInterval(state.timer);
            const q = state.quizData[state.currentQuestionIndex];
            const isCorrect = !isTimeout && state.selectedAnswerKey === q.correctAnswer;

            showFeedback(isCorrect, isTimeout, q.correctAnswer);
            
            setTimeout(() => {
                DOMElements.feedback.overlay.classList.add('hidden');
                state.currentQuestionIndex++;
                loadQuestion();
            }, 2000);
        }

        function showFeedback(isCorrect, isTimeout, correctLabel) {
            const fb = DOMElements.feedback;
            fb.overlay.classList.remove('hidden');
            fb.card.className = 'feedback-card'; // reset classes
            if (isTimeout) {
                fb.card.classList.add('feedback-timeout'); // To be styled
                fb.icon.textContent = '‚è∞';
                fb.title.textContent = '„Çø„Ç§„É†„Ç¢„Ç¶„Éà';
            } else if (isCorrect) {
                fb.card.classList.add('feedback-correct');
                fb.icon.textContent = 'üéâ';
                fb.title.textContent = 'Ê≠£Ëß£ÔºÅ';
            } else {
                fb.card.classList.add('feedback-incorrect');
                fb.icon.textContent = '‚ùå';
                fb.title.textContent = '‰∏çÊ≠£Ëß£';
            }
            fb.message.textContent = isCorrect ? correctLabel : `Ê≠£Ëß£: ${correctLabel}`;
        }
        
        function finishQuiz() {
            showPage('result');
            // „Åì„Åì„Å´ÁµêÊûúË°®Á§∫„É≠„Ç∏„ÉÉ„ÇØ„ÇíËøΩÂä†
        }
        
        function resetHints() {
            state.hintsUsed = { h1: false, h2: false };
            [DOMElements.quiz.hint1Btn, DOMElements.quiz.hint2Btn].forEach(b => b.classList.remove('used'));
            DOMElements.quiz.hintDisplay.classList.remove('show');
            DOMElements.quiz.hintDisplay.textContent = '';
        }

        function setupEventListeners() {
            document.getElementById('loginBtn').onclick = () => {
                state.currentUser = { staffId: document.getElementById('staffId').value };
                showPage('home');
            };
            document.getElementById('startPracticeBtn').onclick = () => startQuiz('practice');
            DOMElements.quiz.submitBtn.onclick = () => submitAnswer(false);
        }
        
        // --- ÂàùÊúüÂåñ ---
        document.addEventListener('DOMContentLoaded', () => {
            setupEventListeners();
            showPage('login');
        });

        // --- „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄÁîªÂÉèÁîüÊàê ---
        function inlinePlaceholder(text){
            text = text || 'Lens';
            const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="150" height="150"><rect width="100%" height="100%" fill="#FFD2EC"/><text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle" font-size="20" fill="#333">${text}</text></svg>`;
            return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
        }

        function setImgSafe(el, url, label){
            if (!el) return;
            el.onerror = function(){ this.onerror=null; this.src = inlinePlaceholder(label); };
            el.src = url || inlinePlaceholder(label);
        }
    })();
    </script>
    <script>
/**
 * Frontend override v2
 * ÁõÆÁöÑÔºö
 *  - „ÉÄ„Éü„ÉºÂïèÈ°å„ÅÆÁîüÊàê„ÇíÂÅúÊ≠¢„Åó„ÄÅGAS„ÅÆ getQuestions „ÇíÂøÖ„ÅöÂëº„Å∂
 *  - ÁîªÂÉè„ÅÆ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÅßÂ§ñÈÉ®„Éâ„É°„Ç§„É≥(via.placeholder.com)„Çí‰Ωø„Çè„Å™„ÅÑÔºàdata URI„ÅßÂÜÖËîµÔºâ
 * ‰Ωø„ÅÑÊñπÔºö index.html „ÅÆ </body> Áõ¥Ââç„Å´ <script src="quiz-override.js"></script> „Å®„Åó„Å¶Ë™≠„ÅøËæº„ÇÄ
 */
(function() {
    'use strict';

    // „É≠„Ç∞Âá∫ÂäõÁî®„Éò„É´„Éë„ÉºÈñ¢Êï∞
    function log() {
        try {
            console.log.apply(console, ['[quiz-hook]'].concat([].slice.call(arguments)));
        } catch(e) {
            // „É≠„Ç∞Âá∫Âäõ„Ç®„É©„Éº„ÅØÁÑ°Ë¶ñ
        }
    }

    // ÂÖÉ„ÅÆ startQuiz Èñ¢Êï∞„Çí‰øùÂ≠ò
    const _origStart = window.startQuiz;

    /**
     * data URI„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄÁîüÊàêÔºàÂ§ñÈÉ®„É™„ÇΩ„Éº„Çπ„Çí‰Ωø„Çè„Å™„ÅÑÔºâ
     * @param {string} text - Ë°®Á§∫„Åô„Çã„ÉÜ„Ç≠„Çπ„Éà
     * @returns {string} data URIÂΩ¢Âºè„ÅÆÁîªÂÉè
     */
    function inlinePlaceholder(text) {
        text = text || 'Lens';
        const svg = `<svg xmlns="http://www.w3.org/2000/svg" width="200" height="200">
            <defs>
                <radialGradient id="g">
                    <stop offset="0%" stop-color="#ffd1dc"/>
                    <stop offset="100%" stop-color="#ff88aa"/>
                </radialGradient>
            </defs>
            <rect width="100%" height="100%" fill="url(#g)"/>
            <circle cx="100" cy="100" r="70" fill="rgba(255,255,255,0.6)"/>
            <text x="50%" y="50%" dominant-baseline="middle" text-anchor="middle"
                  font-size="20" font-family="Noto Sans JP, sans-serif" fill="#333">${text}</text>
        </svg>`;
        return 'data:image/svg+xml;utf8,' + encodeURIComponent(svg);
    }

    // „Ç∞„É≠„Éº„Éê„É´„Å´ÂÖ¨ÈñãÔºàÊó¢Â≠ò„Ç≥„Éº„Éâ„Åã„ÇâÂèÇÁÖßÂèØËÉΩÔºâ
    window.__lensPlaceholder = inlinePlaceholder;

    /**
     * imgË¶ÅÁ¥†„Å´ÁîªÂÉèURL„ÇíÂÆâÂÖ®„Å´Ë®≠ÂÆöÔºà„Ç®„É©„ÉºÊôÇ„ÅØ„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄË°®Á§∫Ôºâ
     * @param {HTMLImageElement} el - ÂØæË±°„ÅÆimgË¶ÅÁ¥†
     * @param {string} url - Ë®≠ÂÆö„Åô„ÇãÁîªÂÉèURL
     * @param {string} label - „Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„ÅÆ„É©„Éô„É´„ÉÜ„Ç≠„Çπ„Éà
     */
    function setImgSafe(el, url, label) {
        if (!el) return;

        el.onerror = function() {
            this.onerror = null;
            this.src = inlinePlaceholder(label || 'Lens');
        };

        el.src = url || inlinePlaceholder(label || 'Lens');
    }

    // „Ç∞„É≠„Éº„Éê„É´„Å´ÂÖ¨Èñã
    window.__setImgSafe = setImgSafe;

    /**
     * GAS„Çµ„Éº„Éê„Éº„Åã„ÇâÂïèÈ°å„Éá„Éº„Çø„ÇíÂèñÂæó„Åó„Å¶„ÇØ„Ç§„Ç∫„ÇíÈñãÂßã
     * @param {number} count - ÂèñÂæó„Åô„ÇãÂïèÈ°åÊï∞
     */
    function startQuizFromSheets(count) {
        const questionCount = count || 10;

        // Google Apps Script API„ÅÆÂ≠òÂú®Á¢∫Ë™ç
        if (!window.google || !google.script || !google.script.run) {
            alert('„Çπ„Éó„É¨„ÉÉ„Éâ„Ç∑„Éº„Éà„Å´Êé•Á∂ö„Åß„Åç„Åæ„Åõ„ÇìÔºàgoogle.script.run Êú™ÂÆöÁæ©Ôºâ„ÄÇGAS „Ç¶„Çß„Éñ„Ç¢„Éó„É™„Å®„Åó„Å¶„Éá„Éó„É≠„Ç§„Åï„Çå„Å¶„ÅÑ„Çã„ÅãÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ');
            // „Éï„Ç©„Éº„É´„Éê„ÉÉ„ÇØÂá¶ÁêÜ
            if (typeof _origStart === 'function') {
                return _origStart();
            }
            return;
        }

        log('fetching questions from GAS...', questionCount);

        // GAS„Åã„ÇâÂïèÈ°å„Éá„Éº„Çø„ÇíÂèñÂæó
        google.script.run
            .withSuccessHandler(function(list) {
                try {
                    // Á©∫„ÅÆ„É¨„Çπ„Éù„É≥„Çπ„ÉÅ„Çß„ÉÉ„ÇØ
                    if (!list || !list.length) {
                        log('empty questions -> fallback');
                        if (typeof _origStart === 'function') {
                            return _origStart();
                        }
                        return;
                    }

                    // Êó¢Â≠òUI„ÅÆÂΩ¢Âºè„Å´Âêà„Çè„Åõ„Å¶„Éá„Éº„ÇøÂ§âÊèõ
                    const questions = list.map(function(q) {
                        return {
                            id: q.questionId,
                            prompt: q.prompt || '„Åì„ÅÆ„Ç´„É©„Ç≥„É≥„ÅØ‰ΩïÔºü',
                            imageLeft: q.imgL,
                            imageRight: q.imgR || q.imgL,
                            options: q.options,
                            correctAnswer: q.correctAnswer,
                            hints: [q.hint1, q.hint2].filter(Boolean)
                        };
                    });

                    // „Ç∞„É≠„Éº„Éê„É´„Çπ„ÉÜ„Éº„Éà„Å´Ë®≠ÂÆö
                    window.App = window.App || {};
                    App.state = App.state || {};
                    App.state.questions = questions;
                    App.state.totalQuestions = questions.length;
                    App.state.currentIndex = 0;

                    // „ÇØ„Ç§„Ç∫ÈñãÂßãÂá¶ÁêÜ
                    if (typeof _origStart === 'function') {
                        _origStart();
                    } else if (typeof window.loadQuestion === 'function') {
                        window.loadQuestion(0);
                    }

                    log('quiz started with sheet data:', questions.length);

                } catch(e) {
                    console.error('Error processing quiz data:', e);
                    if (typeof _origStart === 'function') {
                        return _origStart();
                    }
                }
            })
            .withFailureHandler(function(err) {
                console.error('Failed to fetch questions:', err);
                alert('ÂïèÈ°åÂèñÂæó„Å´Â§±Êïó: ' + (err && err.message ? err.message : err));
                if (typeof _origStart === 'function') {
                    return _origStart();
                }
            })
            .getQuestions({ count: questionCount });
    }

    // „Ç∞„É≠„Éº„Éê„É´„Å´ÂÖ¨Èñã
    window.startQuizFromSheets = startQuizFromSheets;

    // Êó¢Â≠ò„ÅÆ startQuiz „ÇíÁΩÆ„ÅçÊèõ„Åà
    window.startQuiz = function() {
        return startQuizFromSheets(10);
    };

    // loadQuestion „ÅÆ„Éë„ÉÉ„ÉÅÔºà„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄURL„ÅÆÁΩÆÊèõÔºâ
    const _origLoadQuestion = window.loadQuestion;

    window.loadQuestion = function(index) {
        // ÂÖÉ„ÅÆÈñ¢Êï∞„ÇíÂÆüË°å
        if (typeof _origLoadQuestion === 'function') {
            _origLoadQuestion(index);
        }

        try {
            // „É¨„É≥„Ç∫ÁîªÂÉèË¶ÅÁ¥†„ÅÆÂèñÂæó
            const leftLens = document.querySelector(
                '[data-role="lens-left"], #lensLeft, .lens-left img, #imgLeft, #leftLens'
            );
            const rightLens = document.querySelector(
                '[data-role="lens-right"], #lensRight, .lens-right img, #imgRight, #rightLens'
            );

            if (window.App && App.state && App.state.questions) {
                // GAS„Éá„Éº„Çø„Åå„ÅÇ„ÇãÂ†¥Âêà
                const currentIndex = index || App.state.currentIndex || 0;
                const question = App.state.questions[currentIndex];

                if (question) {
                    setImgSafe(leftLens, question.imageLeft, 'Lens');
                    setImgSafe(rightLens, question.imageRight, 'Lens');
                }
            } else {
                // „ÉÄ„Éü„Éº„Éá„Éº„Çø„ÅÆÂ§ñÈÉ®„Éó„É¨„Éº„Çπ„Éõ„É´„ÉÄ„Çídata URI„Å´ÁΩÆÊèõ
                if (leftLens && /via\.placeholder\.com/.test(leftLens.src)) {
                    leftLens.src = inlinePlaceholder('Lens');
                }
                if (rightLens && /via\.placeholder\.com/.test(rightLens.src)) {
                    rightLens.src = inlinePlaceholder('Lens');
                }
            }
        } catch(e) {
            console.warn('[quiz-hook] load patch skipped:', e);
        }
    };

    // ÂàùÊúüÂåñÂÆå‰∫Ü„É≠„Ç∞
    log('Quiz override initialized');

})();
</script>
</body>
</html>